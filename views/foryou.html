Help me fix videos are not playing and help me do it that the scroll serves as play remove all video commands use html to make another play button like tiktok and help me fix the interface make it better but focus on fixing videos to play send full fixed script make the page look better too

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>For You</title>
  <link rel="stylesheet" href="/css/foryou.css">
  <style>
    .verified-mark {
      width: 16px;
      height: 16px;
      margin-left: 3px;
      vertical-align: middle;
    }
    .media-container {
      position: relative;
    }
    .media {
      max-width: 100%;
      max-height: 80vh;
      display: block;
      margin: 0 auto;
    }
    .overlay {
      padding: 10px;
    }
    .caption {
      font-size: 14px;
      color: #333;
    }
  </style>
</head>
<body>
  <div id="posts-container"></div>

  <footer>
    <nav class="footer-nav">
      <button onclick="navigateTo('/search')">Search</button>
      <button onclick="navigateTo('/post')">Post</button>
      <button onclick="navigateTo('/me')">Me</button>
    </nav>
  </footer>

  <script>
    let currentIndex = 0;
let posts = [];
let isTransitioning = false;
let verifiedUsers = [];
let currentUser = null; // To store the logged-in user's details

// Function to fetch the current user (fetches from /api/me)
async function fetchCurrentUser() {
    const username = localStorage.getItem('username');
    
    if (!username) {
        console.error('No user logged in');
        return;
    }

    try {
        const res = await fetch('/api/me', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'x-username': username  // Send the username in the headers
            }
        });

        const data = await res.json();

        if (data.success) {
            currentUser = data.user; // Store current user details
        } else {
            console.error('Failed to fetch current user:', data.message);
        }
    } catch (error) {
        console.error('Error fetching current user:', error);
    }
}

// Function to fetch all posts
async function fetchPosts() {
    try {
        const res = await fetch('/api/posts');
        posts = await res.json();

        const verifiedRes = await fetch('/verified.json');
        const verifiedData = await verifiedRes.json();
        verifiedUsers = verifiedData.verifiedUsers || [];

        renderPost(currentIndex);
    } catch (error) {
        console.error('Error fetching posts or verified users:', error);
    }
}

// Function to render a post
function renderPost(index) {
      if (index < 0 || index >= posts.length) return;
      const postsContainer = document.getElementById('posts-container');
      postsContainer.innerHTML = '';

      const post = posts[index];
      const isVerified = verifiedUsers.includes(post.username);

      const mediaContent = post.file.endsWith('.mp4')
        ? `<div>
             <video class="media" id="video-${index}" muted playsinline>
               <source src="/uploads/${post.file}" type="video/mp4">
               Your browser does not support the video tag.
             </video>
           </div>`
        : `<img src="${post.file}" alt="Post Media" class="media" onerror="this.src='/images/placeholder.png'">`
  : `<img src="/images/placeholder.png" alt="Placeholder" class="media">`;

    postElement.innerHTML = `
        <div class="media-container">
          ${mediaContent}
        </div>
        <div class="overlay">
          <h3 class="username" onclick="navigateTo('/user/${post.username}')">
            ${post.username}
            ${isVerified ? `<img src="/images/verified-placeholder.png" alt="Verified" class="verified-mark" onerror="this.src='/images/verified-placeholder.png'">` : ''}
          </h3>
          <p class="caption" style="color: lightblue;">${post.caption}</p>
          <button class="like-button" onclick="likePost(${index})">
            ${post.liked ? '‚ù§Ô∏è Liked' : 'ü§ç Like'}
          </button>
          <button class="follow-button" onclick="followUser('${post.username}')">
            ${post.following ? 'Following' : 'Follow'}
          </button>
          <span class="like-count">${post.likes || 0} likes</span>
          <button class="share-button" onclick="sharePost('${post.id}')">üîó Share</button>
        </div>
    `;

    postsContainer.appendChild(postElement);
}

// Function to like a post
async function likePost(index) {
    const post = posts[index];
    const username = currentUser ? currentUser.username : null;

    if (!username) {
        alert('You need to log in to like posts.');
        return;
    }

    const updatedLiked = !post.liked;

    try {
        const response = await fetch('/api/like', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ postId: post.id, username, liked: updatedLiked }),
        });

        const data = await response.json();

        if (data.success) {
            // Update the post locally with server response
            post.liked = updatedLiked;
            post.likes = data.likes;
            renderPost(index);
        } else {
            console.error('Error updating like:', data.message);
        }
    } catch (error) {
        console.error('Error updating like:', error);
    }
}

// Function to follow/unfollow a user
async function followUser(followeeUsername) {
    const currentUsername = localStorage.getItem('username'); // Get the logged-in username from localStorage

    if (!currentUsername) {
        alert('You need to log in to follow users.');
        return;
    }

    try {
        const res = await fetch('/api/follow', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'current-username': currentUsername, // Pass current username in headers
            },
            body: JSON.stringify({ followee: followeeUsername }), // Send followee username in the body
        });

        const data = await res.json();

        if (res.ok) {
            // Update the follow status in the current post
            posts[currentIndex].following = !posts[currentIndex].following;

            alert(data.message || `${posts[currentIndex].following ? 'Followed' : 'Unfollowed'} ${followeeUsername}!`);
            renderPost(currentIndex); // Re-render the post to update UI
        } else {
            console.error('Error updating follow status:', data.message);
            alert(data.message || 'Failed to update follow status.');
        }
    } catch (error) {
        console.error('Error following user:', error);
        alert('An error occurred. Please try again.');
    }
}

// Function to share a post
function sharePost(postId) {
    const uniqueLink = `${window.location.origin}/foryou?post=${postId}`;
    navigator.clipboard.writeText(uniqueLink).then(() => {
        alert('Post link copied to clipboard!');
    }).catch(err => {
        console.error('Failed to copy link:', err);
    });
}

function togglePlayPause(index) {
  const video = document.getElementById(`video-${index}`);
  const playButton = document.getElementById(`play-button-${index}`);

  if (video.paused) {
    video.play();
    playButton.innerText = 'Pause';
  } else {
    video.pause();
    playButton.innerText = 'Play';
  }
}

// Function to navigate between posts
function navigatePost(direction) {
    if (isTransitioning) return;
    isTransitioning = true;

    const newIndex = currentIndex + direction;
    if (newIndex >= 0 && newIndex < posts.length) {
        currentIndex = newIndex;
        renderPost(currentIndex);
    }

    setTimeout(() => {
        isTransitioning = false;
    }, 300);
}

// Event listeners for touch navigation
let startY = 0;
window.addEventListener('touchstart', (e) => {
    startY = e.touches[0].clientY;
});

window.addEventListener('touchend', (e) => {
    const endY = e.changedTouches[0].clientY;
    const distance = startY - endY;

    if (distance > 50) navigatePost(1);
    else if (distance < -50) navigatePost(-1);
});

// Function to navigate to a new route
function navigateTo(route) {
    window.location.href = route;
}

// Fetch user and posts when the app loads
async function initializeApp() {
    await fetchCurrentUser();  // Fetch the current user
    await fetchPosts();        // Fetch all posts
}

// Initialize scroll-based autoplay
    function initializeScrollAutoplay() {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            const video = entry.target;
            if (entry.isIntersecting) {
              video.play().catch((err) => console.error('Autoplay failed:', err));
            } else {
              video.pause();
            }
          });
        },
        { threshold: 0.5 } // Play when 50% of the video is visible
      );

      // Observe all videos
      document.querySelectorAll('video').forEach((video) => observer.observe(video));
    }

    // Initialize the app
    async function initializeApp() {
      await fetchCurrentUser();
      await fetchPosts();
      initializeScrollAutoplay();
    }

initializeApp();
  </script>
</body>
</html>
